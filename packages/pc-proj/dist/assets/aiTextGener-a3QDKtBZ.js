import{be as x,bf as g,bg as S,bh as T,r as l}from"./index-64wCEMT-.js";function w(e){return{slides:e.slides.map(P)}}function P(e){return{type:"slide",elements:e.elements.map(f).filter(t=>!!t)}}function _(e){const t=g(e.content);if(t)return{type:"shape",content:t}}function b(e){const t=g(e.content);if(t)return{type:"text",content:t}}function z(e){return{type:"table",content:e.data.map(t=>t.map(s=>({...s,text:g(s.text)})))}}function A(e){return{type:"chart",chartType:e.chartType,data:e.data}}function E(e){return{type:"diagram",elements:e.elements.map(f).filter(t=>!!t)}}function f(e){switch(e.type){case"shape":return _(e);case"text":return b(e);case"table":return z(e);case"chart":return A(e);case"diagram":return E(e);case"group":return{type:"group",elements:e.elements.map(f).filter(t=>!!t)}}}async function R(e){const t=new x;return e.slides.forEach(s=>{F(t,s)}),t.write()}function F(e,t){const s=e.addSlide();t.elements.forEach(n=>{v(s,n)})}function v(e,t){switch(t.type){case"shape":return e.addText(t.content,{shape:"rect"});case"text":return e.addText(t.content);case"table":return e.addTable(t.content)}}var C=(e=>(e.UPLOAD_BASE64_IMAGE="/file/uploadBase64Img",e.UPLOAD_IMG_FILE="/file/uploadImgFile",e))(C||{});async function B(e){return new Promise(t=>{const s=new FileReader;s.readAsDataURL(e),s.onload=n=>t(n.target.result)})}async function D(e){const{promise:t,resolve:s}=S(),n=new FileReader;return n.readAsArrayBuffer(e),n.onload=async r=>{const o=await T(r.target.result);s(w(o))},t}function G(e,t,s={count:50,expire:60*60*24*7}){const n=()=>{const a=e.get(t);return a?JSON.parse(a):[]},r=l.useRef(n()),o=a=>{r.current.push(...a),e.set(t,JSON.stringify(r.current.slice(-s.count)),s.expire)};return{historyMessages:r.current,saveMessages2LocalStore(a){setTimeout(()=>o(a),500)}}}var I=(e=>(e.GetGPTContent="/ai/gptContent",e))(I||{});function O(e,t){const{historyMessages:s,saveMessages2LocalStore:n}=G(t,`__${e}_gpt_message_key__`),[r,o]=l.useState(""),[a,i]=l.useState([...s]);return{prompt:r,setPrompt:o,messages:a,setMessages:i,chat:async m=>{o("");const d=[...a,{role:"user",content:r},{role:"assistant",content:""}],M=d.slice(-5,-1);i(d);try{const p=await m(M);let c="";for await(const h of p)i(u=>{const y=u[u.length-1];return[...u.slice(0,u.length-1),{...y,content:y.content+h}]}),c=c+h;n([{role:"user",content:r},{role:"assistant",content:c}])}catch(p){i(c=>[...c.slice(0,c.length-1),{role:"assistant",content:p.message||"抱歉，回复失败"}])}}}}export{I as U,G as a,C as b,R as g,B as i,D as p,O as u};
