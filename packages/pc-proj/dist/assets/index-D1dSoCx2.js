import{r as p,W as j,j as n,I as m,B as P,s as v}from"./index-7zKW46BM.js";import{P as C}from"./index-V5yCTLRh.js";import{S as N}from"./index-DID9pq4H.js";import"./addEventListener-Ckdk3TQo.js";function S(e,s=5){const[r,u]=p.useState({keyword1:"",keyword2:""}),[g,i]=p.useState(0),[t,a]=p.useState(s),[o,c]=p.useState({total:0,data:[]});return{query:r,changeQuery:(h,d)=>{u({...r,[h]:d})},limit:t,pageNo:g,poetryPagination:o,search:async()=>{if(!r.keyword1&&!r.keyword2)throw new Error("请输入关键词");i(0);const h=await e({pageNo:g,limit:t,...r});c(h)},changePage:async(h,d)=>{i(h),a(d);const y=await e({pageNo:h,limit:d,...r});c(y)}}}function b(e,s,r){if(!s&&!r)return e.split("");let u;!s||!r?u=e.split(s||r):u=e.split(k(s,r));const g=(i,t,a)=>{if(!t)return{chunks:[a],len:a.length};if(!a)return{chunks:[t],len:t.length};let o,c;i.startsWith(t)?[o,c]=[t,a]:[c,o]=[t,a];const x=i.indexOf(c);return{chunks:[o,i.slice(o.length,x),c],len:x+c.length}};return u.reduce(({result:i,index:t},a)=>{if(t+a.length===e.length)return{result:[...i,a],index:t+a.length};const o=g(e.slice(t+a.length),s,r);return{result:[...i,a,...o.chunks],index:t+a.length+o.len}},{result:[],index:0}).result}const k=(e,s)=>new RegExp(`${e}[^。]*${s}|${s}[^。]*${e}`),{Http:{request:I}}=j;function B(e){return I({method:"get",url:"/poetry/getPoetriesByAuthorAndKeyWords",params:{...e}})}function E(){const{query:e,changeQuery:s,limit:r,pageNo:u,poetryPagination:g,search:i,changePage:t}=S(B),[a,o]=p.useState(!1),c=[{title:"名字",dataIndex:"title",key:"title"},{title:"作者",dataIndex:"author",key:"author"},{title:"内容",dataIndex:"content",key:"content",render:p.useCallback(l=>{const h=b(l,e.keyword1,e.keyword2);return n.jsx("div",{className:"poetry-content",children:h.map((d,y)=>n.jsx("span",{className:[e.keyword1,e.keyword2].includes(d)?"keyword":"",children:d},y))})},[g]),width:750}],x=async(l,h)=>{t(l,h)},f=async()=>{try{o(!0),await i()}catch(l){v.error(l.message)}finally{o(!1)}};return n.jsxs("div",{className:"poetry-search",children:[n.jsx(N,{spinning:a,fullscreen:!0}),n.jsxs("div",{className:"search",children:[n.jsxs("div",{className:"author",children:[n.jsx("span",{children:"作者："}),n.jsx(m,{placeholder:"请输入作者",value:e.author,maxLength:20,onChange:l=>s("author",l.target.value)})]}),n.jsxs("div",{className:"keyword",children:[n.jsx("span",{children:"关键词1："}),n.jsx(m,{placeholder:"请输入关键词",value:e.keyword1,maxLength:20,onChange:l=>s("keyword1",l.target.value)})]}),n.jsxs("div",{className:"keyword",children:[n.jsx("span",{children:"关键词2："}),n.jsx(m,{placeholder:"请输入关键词",value:e.keyword2,maxLength:20,onChange:l=>s("keyword2",l.target.value)})]}),n.jsx(P,{onClick:f,children:"搜索"})]}),n.jsx(C,{tableProps:{columns:c,rowKey:l=>l.id,scroll:{y:500}},paginationData:g,pageNo:u,limit:r,onChangeTable:x})]})}export{E as default};
