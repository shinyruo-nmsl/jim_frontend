import{W as N,j as e,F as d,I as O,B as P,U as y,P as B,C as _,f as F,a as L,S as M,M as v,r as i,s as k,R as A}from"./index-64wCEMT-.js";import{S as j,P as V}from"./index-BUdZbcXf.js";import"./addEventListener-Beddz_eB.js";import"./index-Bqk1BXhs.js";const{Http:{request:g}}=N;function S(t){return g({method:"get",url:"/admin/searchUserLoginInfo",params:{...t}})}function W(t,s){return g({method:"post",url:"/admin/updateUserRole",data:{userId:t,role:s}})}function H(t){return g({method:"delete",url:"/admin/removeUser",data:{userId:t}})}function K({query:t={},onChaneQuery:s,onClickConfirmButton:l}){const u=[{label:"全部",value:""},...y],c=[{label:"全部",value:""},...B];return e.jsx("div",{className:"admin-search-bar",children:e.jsxs(d,{layout:"inline",children:[e.jsx(d.Item,{label:"平台",children:e.jsx(j,{style:{width:200},value:t.platform,options:c,onChange:n=>{s({...t,platform:n})}})}),e.jsx(d.Item,{label:"角色",children:e.jsx(j,{style:{width:200},value:t.role,options:u,onChange:n=>{s({...t,role:n})}})}),e.jsx(d.Item,{label:"用户ID/昵称/账号",children:e.jsx(O,{value:t.searchTerm,onChange:n=>{s({...t,searchTerm:n.target.value})}})}),e.jsx(d.Item,{children:e.jsx(P,{onClick:l,children:"确定"})})]})})}function Q({data:t,limit:s,pageNo:l,onChangeTable:u,onClickEditTag:c,onClickDeleteTag:n}){const o=[{title:"用户ID",dataIndex:"userId",key:"userId"},{title:"用户账号",dataIndex:"account",key:"account"},{title:"用户头像",dataIndex:"avatar",key:"avatar",render:(r,{userName:x,avatar:h})=>e.jsx(_,{characterName:x,avatar:h})},{title:"用户昵称",dataIndex:"userName",key:"userName"},{title:"平台",dataIndex:"platform",key:"platform",render:r=>e.jsx("span",{children:F(r)})},{title:"角色",dataIndex:"role",key:"role",render:r=>e.jsx("span",{children:L(r)})},{title:"操作",key:"operate",render:(r,x,h)=>e.jsxs(M,{children:[e.jsx("a",{onClick:()=>c(h),children:"编辑"}),e.jsx("a",{onClick:()=>n(h),children:"删除"})]})}];return e.jsx(V,{tableProps:{columns:o,rowKey:r=>r.userId,scroll:{y:500}},paginationData:t,pageNo:l,limit:s,onChangeTable:u})}function G({visible:t,form:s,onChangeForm:l,onCloseModal:u,onConfirm:c}){return e.jsx(v,{open:t,title:"用户信息调整",centered:!0,cancelText:"取消",okText:"确认",onCancel:u,onOk:c,children:e.jsxs(d,{children:[e.jsx(d.Item,{label:"用户名",children:e.jsx("p",{children:s.account})}),e.jsx(d.Item,{label:"角色",children:e.jsx(j,{value:s.role,onChange:n=>l({...s,role:n}),children:y.map(({label:n,value:o})=>e.jsx(j.Option,{value:o,children:n}))})})]})})}function $(){const[t,s]=i.useState({searchTerm:"",role:"",platform:""}),[l,u]=i.useState(0),[c,n]=i.useState(10),[o,r]=i.useState({total:0,data:[]}),[x,h]=i.useState(-1),[p,C]=i.useState(null),[T,I]=i.useState(!1),U=async()=>{try{const a=await S({...t,limit:c,pageNo:l});r(a)}catch(a){k.error(a.message)}},b=async(a,m)=>{u(a),n(m);const f=await S({...t,limit:m,pageNo:a});r(f)},R=a=>{h(a),C({...o.data[a]}),I(!0)},{confirm:D}=v,w=a=>{D({title:"警告",icon:e.jsx(A,{}),content:"您是否确定删除此用户？",okText:"删除",cancelText:"取消",async onOk(){await H(o.data[a].userId);const m=[...o.data];m.splice(a,1),r({...o,data:m})},onCancel(){}})},E=async()=>{try{const{userId:a,role:m}=p;await W(a,m),I(!1);const f=[...o.data];f.splice(x,1,{...p}),r({...o,data:f})}catch(a){k.error(a.message)}};return i.useEffect(()=>{b(l,c)},[]),e.jsxs("div",{className:"w-full box-border p-24",children:[e.jsx(K,{query:t,onChaneQuery:s,onClickConfirmButton:U}),e.jsx(Q,{data:o,limit:c,pageNo:l,onChangeTable:b,onClickEditTag:R,onClickDeleteTag:w}),p&&e.jsx(G,{visible:T,form:p,onChangeForm:C,onCloseModal:()=>I(!1),onConfirm:E})]})}export{$ as default};
