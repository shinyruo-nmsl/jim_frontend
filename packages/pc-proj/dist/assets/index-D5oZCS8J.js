import{j as e,b0 as j,C as I,r as i,W as v,b1 as A,I as y,s as E}from"./index-7zKW46BM.js";import{u as N,W as C}from"./index-DYrcAvlH.js";import{I as u}from"./index-DjF3hdwP.js";import{S as b}from"./index-DID9pq4H.js";import{D as P}from"./index-CC_F14Rm.js";import"./aiTextGener-BeKmR5ky.js";import"./addEventListener-Ckdk3TQo.js";function U({message:s}){return e.jsxs("div",{className:"ai-image-message user",children:[e.jsx("div",{className:"dialog",children:s.content}),e.jsx(j,{})]})}function L({message:s}){return e.jsxs("div",{className:"ai-image-message assistant",children:[e.jsx(I,{characterName:"A"}),e.jsx("div",{className:"dialog",children:Array.isArray(s.content)?s.content.length>0?e.jsx(u.PreviewGroup,{children:s.content.map(a=>e.jsx(u,{src:a,width:200},a))}):e.jsx(b,{}):e.jsx("div",{children:s.content})})]})}function S({message:s}){return s.type==="assistant"?e.jsx(L,{message:s}):e.jsx(U,{message:s})}const{Storage:{default:W},Html:{awaitAllChildrenImgsLoaded:g}}=v,{User:{useUserLoginInfo:w}}=A,{AI:{fetchGetAIImages:B}}=C;function z(){const{userId:s}=w(),{messages:a,prompt:c,setPrompt:p,getImages:f}=N(s,W),[l,m]=i.useState(!1),n=i.useRef(null),{TextArea:x}=y,h=async t=>{if(!(t.keyCode===229||c.prompt.length<1||l)){m(!0);try{await f(B)}catch(r){E.error(r.message)}finally{m(!1)}}},o=()=>{n.current&&(n.current.scrollTop=n.current.scrollHeight)};return i.useLayoutEffect(()=>{var r;const t=a[a.length-1];if(typeof(t==null?void 0:t.content)=="string")o();else{const d=(r=n.current)==null?void 0:r.lastElementChild;d&&g(d,o)}},[a]),i.useLayoutEffect(()=>{g(n.current,o)},[]),e.jsxs("div",{className:"ai-image-page",children:[e.jsx("div",{className:"message-container",ref:n,children:a.map((t,r)=>e.jsx(S,{message:t},r))}),e.jsx(P,{}),e.jsx("div",{className:"edit-container",children:e.jsx(x,{value:c.prompt,disabled:l,maxLength:600,onChange:t=>p(r=>({...r,prompt:t.target.value})),onPressEnter:h,placeholder:"请输入问题",style:{height:120,resize:"none"}})})]})}export{z as default};
