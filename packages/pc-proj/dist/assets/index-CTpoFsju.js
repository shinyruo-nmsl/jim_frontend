import{j as e,b0 as h,C as b,r as a,b1 as j,s as m,W as w}from"./index-64wCEMT-.js";import{a as I,W as v}from"./index-DlVgwk1V.js";import{I as y}from"./index-BWSCSMiC.js";import{W as U}from"./index-EgsoIQEg.js";import{S as N}from"./index-Bqk1BXhs.js";import"./aiTextGener-a3QDKtBZ.js";import"./index-DRC_xhUG.js";import"./addEventListener-Beddz_eB.js";const{MarkdownText:P}=U;function A({content:s}){return e.jsxs("div",{className:"w-full flex items-start gap-10 justify-end",children:[e.jsxs("div",{className:"w-fit max-w-[800px]  flex flex-col items-center gap-2 bg-green-600 rounded-[5px] p-[12px] text-[12px]/[16px] break-all text-white",children:[e.jsx("img",{className:"h-[120px] w-auto",src:s.imgUrl,alt:s.description}),e.jsx("div",{className:"self-start",children:`描述：${s.description}`})]}),e.jsx(h,{})]})}function S({content:s}){return e.jsxs("div",{className:"w-full flex items-start gap-10",children:[e.jsx(b,{characterName:"A"}),s.length>0?e.jsx(P,{content:s,hlStyle:{borderRadius:"5px",padding:"10px",margin:"10px 0",overflowX:"auto"},iconStyle:{top:"5px",right:"5px",cursor:"pointer",width:"25px",height:"25px"}}):e.jsx("div",{className:"w-fit max-w-[800px] bg-[azure] border border-solid border-[blue] rounded-[5px] p-[12px] text-[12px]/[16px] break-all",children:e.jsx(N,{})})]})}function W({message:s}){return s.type==="assistant"?e.jsx(S,{content:s.content}):e.jsx(A,{content:s.content})}const{File:{fetchUploadImgFile:C},AI:{fetchGetAIParseMessage:E}}=v,{User:{useUserLoginInfo:M}}=j,{Storage:{default:R}}=w;function X(){const{userId:s}=M(),{prompt:t,setPrompt:c,messages:x,chat:d}=I(s,R),[l,i]=a.useState(null),[n,p]=a.useState(!1),o=a.useRef(null),f=async()=>{if(!(!l||!t.description||n))try{const{url:r}=await C({imgFile:l.file});c({...t,imgUrl:r}),i(null)}catch(r){m.error(r.message)}},u=async()=>{if(!n){p(!0);try{await d(E)}catch(r){m.error(r.message)}finally{p(!1)}}};return a.useEffect(()=>{t.imgUrl&&t.description&&u()},[t]),a.useLayoutEffect(()=>{o.current&&(o.current.scrollTop=o.current.scrollHeight)},[x]),e.jsxs("div",{className:"h-full box-border flex flex-col",children:[e.jsx("div",{className:"box-border w-full p-[24px] flex-1 overflow-y-auto flex flex-col gap-[20px]",ref:o,children:x.map((r,g)=>e.jsx(W,{message:r},g))}),e.jsx("div",{className:"box-border w-full h-fit p-[24px] flex-none",children:e.jsx(y,{value:t.description,img:l,textareaProps:{placeholder:"使用图片时，复制图片到此处，或者点击上传",maxLength:1e3,disabled:n},onPressEnter:f,onChange:r=>c({...t,description:r}),onUploadImg:r=>i(r),onRemoveImg:()=>i(null)})})]})}export{X as default};
